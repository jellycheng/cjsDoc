<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>ansible</title>
</head>
<body>
<h3>ansible</h3>

<pre>
	saltstack,ansible是python开发的
	puppet,chef是ruby开发
官网：https://www.ansible.com/	https://docs.ansible.com/
	ssh协议库： https://github.com/paramiko/paramiko
		http://www.paramiko.org/
源码：https://github.com/ansible/ansible	
ansible安装：
which ansible
1. rpm -ql ansible
	yum search ansible
	yum install ansible
	#apt-get install ansible
	#sudo pkg install ansible
	[root@aaz-dev001 test]# rpm -ql ansible |grep bin
		/usr/bin/ansible   执行命令
		/usr/bin/ansible-console
		/usr/bin/ansible-doc  查看手册，文档命令
		/usr/bin/ansible-galaxy
		/usr/bin/ansible-playbook
		/usr/bin/ansible-pull
		/usr/bin/ansible-vault
	yum安装的ansible位置：/etc/ansible/
		host机器配置文件（从机器ip或机器名）：/etc/ansible/hosts  文件支持分组和不分组配置，配置格式跟php.ini一样
		ansible配置文件：/etc/ansible/ansible.cfg  配置格式跟php.ini一样
	查看版本：ansible --version 
2. ansible是python开发的，所以可以使用pip安装：  sudo pip install ansible
3. ansible源码安装：进入源码目录，执行 python setup.py install
4. rpm包安装： rpm -ivh 包名.rpm

设置ansible环境变量：
	echo "export ANSIBLE_HOSTS=~/ansible_hosts">>~/.bashrc
	#echo "source ~/ansible/hacking/env-setup">>~/.bashrc
	或者 使用默认的 export ANSIBLE_HOSTS=/etc/ansible/hosts

ansible命令使用格式： ansible &lt;host-pattern匹配目标机器> [options选项]
	ansible 主机配置文件中组名或ip或机器名  [options选项]
	ansible 主机配置文件中组名或ip或机器名 -m 模块名 -a "参数"
1.配置目标机器：vi /etc/ansible/hosts 在文件中增加一行127.0.0.1
2.执行命令：ansible all -m ping 等价 ansible all -m ping -i /etc/ansible/hosts  其中-i指定ansible主机配置文件
	ansible 127* -m ping
提示输入ssh密码，可以增加--ask-pass参数，如 ansible all -m ping --ask-pass

which pip
pip -h
pip命令不存在可以使用 sudo easy_install pip 安装，或者pip源码安装python setup.py install
ansible执行有些命令需要解析json，所以要安装下python的json： pip install python-simplejson
安装ansible依赖的python模块： sudo pip install paramiko PyYAML Jinja2 httplib2 six python-simplejson simplejson

[root@aaz-dev001 test]# cat /etc/ansible/hosts 
#不分组配置
127.0.0.1 #表本机
green.example.com
blue.example.com
192.168.100.1
192.168.100.10
#分组配置
[webservers分组名]
 alpha.example.org
 beta.example.org
 192.168.1.100
 192.168.1.110
[aaz-dev]  #此时就可以使用 ansible aaz-dev -m ping 执行了
10.59.80.13
10.59.80.12

ansible支持的常见模块：
	command,copy,file,ping,setup,git,svn,apt，raw，shell
	service：系统服务管理
	cron：计划任务管理
	yum：yum软件包安装管理
	synchronize：使用rsync同步文件
	user：系统用户管理
	group：系统用户组管理

ImportError: No module named ansible.constants{
	说明python的ansible包找不到。
	原因： yum安装用的python是2.6或者其它，跟环境变量中的python版本不一致导致的。
		[root@aaz-dev001 test]# cat /usr/bin/yum
			#!/usr/bin/python2.6.6
	解决办法：
		1. 方式1： vi /usr/bin/ansible 把#!/usr/bin/python 改成 #!/usr/bin/python2.6.6
			vi /usr/bin/ansible-doc 文件同理
		2.方式2：yum 卸载，然后使用pip安装 sudo pip install ansible
}

cat ~/.ssh/authorized_keys 此文件保存其它机器的公钥
ls ~/.ssh/
cat ~/.ssh/id_rsa 本机私钥文件
本机生成公钥和私钥：
	ssh-keygen -t rsa


[root@aaz-dev001 ansible]# ansible-doc -h
Usage: ansible-doc [options选项] [module...模块名]
Options:
  -h, --help            show this help message and exit
  -l, --list            List available modules列出所有支持的模块
  -M MODULE_PATH, --module-path=MODULE_PATH
                        specify path(s) to module library (default=None)
  -s, --snippet         Show playbook snippet for specified module(s)
  -v, --verbose         verbose mode (-vvv for more, -vvvv to enable
                        connection debugging)
  --version             show program's version number and exit
例子： ansible-doc file


安装nginx：
	ps aux|grep nginx
	rpm -ql nginx
	rpm -qa nginx



yaml语法：http://yaml.org/
	语法缩进使用2个空格，而不用tab缩进
	-加空格 表示数组
	:加空格分割 表是键值对配置，json对象
	文件扩展名.yaml
#表注释	
- 值1
- 值2
- 值N
american:
  - Boston Red Sox
  - Detroit Tigers
  - New York Yankees
national:
  - New York Mets
  - Chicago Cubs
  - Atlanta Braves
-
  name: Mark McGwire
  hr:   65
  avg:  0.278
-
  name: Sammy Sosa
  hr:   63
  avg:  0.288





</pre>
</body>
</html>
